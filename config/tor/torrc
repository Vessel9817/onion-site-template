# https://manpages.debian.org/bookworm/tor/torrc.5.en.html
# https://riseup.net/en/security/network-security/tor/onionservices-best-practices

# Exposing onion site to tor network and redirecting requests to nginx
HiddenServiceDir /var/lib/tor/website/
HiddenServiceVersion 3
HiddenServicePort 80 10.5.0.2:80

# Firewalling
SafeSocks 1
TestSocks 1
ReachableAddresses accept *:*, reject 10.0.0.0/8:*, accept 10.5.0.1:80, accept 127.0.0.1:80
CountPrivateBandwidth 1
ProtocolWarnings 1
Sandbox 1
GeoIpExcludeUnknown auto
StrictNodes 0
ExitPolicyRejectPrivate 1
RefuseUnknownExits auto
ServerDNSAllowBrokenConfig 0
ServerDNSAllowNonRFC953Hostnames 0
ServerDNSDetectHijacking 1
ServerDNSRandomizeCase 1
ServerDNSSearchDomains 0
ServerDNSTestAddresses "www.google.com, www.mit.edu, www.yahoo.com, www.slashdot.org, duckduckgo.com"
HiddenServiceDirGroupReadable 0
HiddenServiceNonAnonymousMode 0

# Protecting against denial-of-service (DoS)
DoSCircuitCreationEnabled 1
DoSConnectionEnabled auto
DoSConnectionDefenseType 2
DoSRefuseSingleHopClientRendezvous 1

# Removing potentially identifying client information, if possible
SafeLogging 1
ExtraInfoStatistics 0

# Using log file appending instead of overwriting at startup
TruncateLogFile 0

# Increasing discovery protection
CircuitPadding 1
ConnectionPadding 1
UseEntryGuards 1
VanguardsLiteEnabled 1
